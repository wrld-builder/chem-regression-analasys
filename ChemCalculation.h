#ifndef CHEMCALCULATION_H
#define CHEMCALCULATION_H

#include <vector>

/**
 * \file ChemCalculation.h
 * \brief Заголовочный файл для класса ChemCalculation.
 *
 * Этот файл содержит объявление структуры \c CalculationResult и класса \c ChemCalculation,
 * предназначенных для расчёта параметров химической реакции по экспериментальным данным.
 *
 * \author Шунин Михаил Дмитриевич
 * \date Февраль 2025
 */

/**
 * \brief Структура для хранения результатов расчёта.
 *
 * Содержит следующие поля:
 * - \c n: Порядок реакции.
 * - \c k: Константа скорости.
 * - \c r: Коэффициент корреляции.
 * - \c disp: Дисперсия (среднеквадратичная ошибка).
 */
struct CalculationResult {
  double n;     ///< Порядок реакции.
  double k;     ///< Константа скорости.
  double r;     ///< Коэффициент корреляции.
  double disp;  ///< Дисперсия.
};

/**
 * \brief Класс для расчёта параметров химической реакции.
 *
 * Данный класс предоставляет статический метод для вычисления параметров реакции
 * по экспериментальным данным. Метод \c Calculate принимает векторы концентраций и времени,
 * а также начальные концентрации для веществ B и C, и возвращает структуру \c CalculationResult,
 * содержащую рассчитанные параметры реакции.
 */
class ChemCalculation {
 public:
  /**
   * \brief Выполняет расчёт параметров химической реакции.
   *
   * Функция принимает два вектора экспериментальных данных:
   * \li \a Ca - значения концентрации вещества A,
   * \li \a Tm - соответствующие моменты времени.
   *
   * Дополнительно задаются начальные концентрации:
   * \li \a Cb для вещества B,
   * \li \a Cc для вещества C.
   *
   * Перед проведением расчёта функция проверяет корректность входных данных:
   * \li Начальные концентрации \a Cb и \a Cc не могут быть отрицательными.
   * \li Все значения концентрации \a Ca должны быть неотрицательными.
   * \li Значения времени в векторе \a Tm должны строго возрастать (t[i+1] > t[i]).
   * \li Должно быть предоставлено не менее двух точек для расчёта.
   *
   * Затем функция выполняет регрессионный анализ и вычисляет:
   * \li \c n - порядок реакции;
   * \li \c k - константу скорости реакции;
   * \li \c r - коэффициент корреляции;
   * \li \c disp - дисперсию, представляющую среднеквадратичную ошибку между экспериментальными 
   *       и смоделированными значениями концентрации.
   *
   * \param Ca Вектор экспериментальных значений концентрации A.
   * \param Tm Вектор моментов времени, соответствующих значениям в \a Ca.
   * \param Cb Начальная концентрация вещества B.
   * \param Cc Начальная концентрация вещества C.
   *
   * \return Структура \c CalculationResult с рассчитанными параметрами реакции.
   *
   * \throw std::runtime_error Если входные данные некорректны или если не удаётся провести вычисления (например, деление на ноль).
   */
  static CalculationResult Calculate(const std::vector<double>& Ca,
                                     const std::vector<double>& Tm,
                                     double Cb, double Cc);
};

#endif  // CHEMCALCULATION_H
